!function(a,b,c,d){"use strict";var e=b.module("reportGenerator",["dataset-types","advanced-search","display-fields","services.config"]),f=d("#results");e.run(["$http","$rootScope","configuration",function(a,b,e){function g(a){var b=/(.*?)((?: (?:OR|AND) )|$)/g;return 0===a.length?"*":a=a.replace(b,function(a,b,c){return 0===b.length||b.match(/:[\(\[].*?[\)\]]/)||(b="entext:("+b+")"),b+c})}function h(a,b){var c,d,f,g,h;for(d=0;d<a.length;d+=1)for(c=a[d],g=0;g<b.length;g+=1)f=b[g],h=c[f],c[f]=h||"","name"===f?c[f]=""+h+' <a target="_blank" href="'+e.ckanInstance+"/dataset/"+h+'" class="btn btn-default"><span class="glyphicon glyphicon-eye-open"><span class="wb-inv">View '+h+'</span></a><a target="_blank" href="'+e.ckanInstance+"/dataset/edit/"+h+'" class="btn btn-default"><span class="glyphicon glyphicon-pencil"><span class="wb-inv">Edit '+h+"</span></a>":"object"==typeof h&&(c[f]=h.join(","));return a}function i(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push({data:a[b],title:a[b]});return c}function j(){var a=c.pageUrlParts.params.rows;return b.maxResultsOptions[a]?a:void 0}b.query=c.pageUrlParts.params.q?decodeURI(c.pageUrlParts.params.q):"",b.maxResultsOptions={20:20,50:50,100:100,1e3:"1000 (default)",2e3:2e3},b.maxResults=j()||"1000",b.clearKeywords=function(){b.query=""},b.saveUrl=function(){var a=c.pageUrlParts,d=a.absolute.replace(a.search,"").replace(a.hash,"");b.savedUrl=d+"?fq="+b.dataTypeCtrl.selectedDatasetTypes.join(",")+"&q="+b.query+"&fl="+b.dspFieldCtrl.fields.join(",")+"&rows="+b.maxResults},b.sendQuery=function(){var c=e.solrCore+"/select",j={wt:"json","json.wrf":"JSON_CALLBACK",otherparams:"",fq:"dataset_type:"+b.dataTypeCtrl.selectedDatasetTypes.join(" OR "),q:g(b.query),fl:b.dspFieldCtrl.fields.join(","),rows:parseInt(b.maxResults,10)};a.jsonp(c,{params:j}).then(function(a){b.queryResultsCount=a.data.response.numFound,b.queryResults=a.data.response,b.downloadLink=a.config.url+"?"+d.param(d.extend({},a.config.params,{wt:"csv"}));var c=a.data.responseHeader.params.fl.split(","),e={data:h(b.queryResults.docs,c),columns:i(c),columnDefs:[{className:"nowrap right",targets:[0]}],pageLength:100,lengthMenu:[[50,100,200,500,-1],[50,100,200,500,"All"]]};f.DataTable().destroy(),f.empty().removeClass("wb-tables-inited wb-init").attr("data-wb-tables",JSON.stringify(e)).trigger("wb-init.wb-tables")})}}])}(window,angular,wb,jQuery),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(a,b){function c(a,b,c){if(angular.isArray(a))for(var d=a.length;d--;)if(c(a[d],b))return!0;return!1}function d(a,b,d){return a=angular.isArray(a)?a:[],c(a,b,d)||a.push(b),a}function e(a,b,c){if(angular.isArray(a))for(var d=a.length;d--;)if(c(a[d],b)){a.splice(d,1);break}return a}function f(f,g,h){function i(a,b){f.checked=c(a,m,n)}b(g)(f);var j=a(h.checklistModel),k=j.assign,l=a(h.checklistChange),m=a(h.checklistValue)(f.$parent),n=angular.equals;h.hasOwnProperty("checklistComparator")&&(n=a(h.checklistComparator)(f.$parent)),f.$watch("checked",function(a,b){if(a!==b){var c=j(f.$parent);a===!0?k(f.$parent,d(c,m,n)):k(f.$parent,e(c,m,n)),l&&l(f)}}),angular.isFunction(f.$parent.$watchCollection)?f.$parent.$watchCollection(h.checklistModel,i):f.$parent.$watch(h.checklistModel,i,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(a,b){if("INPUT"!==a[0].tagName||"checkbox"!==b.type)throw'checklist-model should be applied to `input[type="checkbox"]`.';if(!b.checklistValue)throw"You should provide `checklist-value`.";return a.removeAttr("checklist-model"),a.attr("ng-model","checked"),f}}}]),function(a,b){"use strict";var c=b.module("advanced-search",["fields"]);c.controller("AdvancedSearchController",["$rootScope",function(a){this.emptyKey=!1,this.operator="AND",this.keyword="",this.addField=function(){var b,c="";this.field&&(this.keyword||this.emptyKey)&&(b=this.emptyKey?"-"+this.field+':["" TO *]':this.field+":(*"+this.keyword+"*)",a.query&&""!==a.query.trim()&&(c=" "+(this.emptyKey?"AND":this.operator)+" "),a.query+=c+b,this.keyword="")}}]),c.directive("advancedSearch",function(){return{restrict:"E",templateUrl:"templates/advanced-search.html",controller:"AdvancedSearchController",controllerAs:"advSrchCtrl"}}),String.prototype.trim||!function(){var a=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(a,"")}}()}(window,angular),function(a,b,c){"use strict";var d=b.module("dataset-types",["checklist-model","services.config"]);d.controller("DatasetTypesController",["$http","$rootScope","configuration",function(a,b,d){function e(a){var b=["codeset","geodescriptor","subject","survey"];return a.filter(function(a){return-1===b.indexOf(a)?!0:!1})}function f(){var a=c.pageUrlParts.params.fq,b=[];return a&&(decodeURI(a).split(",").forEach(function(a){-1!==h.datasetTypes.indexOf(a)&&b.push(a)}),b.length>0)?b:null}var g=d.solrCore+"/select?q=*:*&rows=0&wt=json&json.wrf=JSON_CALLBACK&facet=true&facet.field=dataset_type",h=this;this.changed=function(){b.$emit("datasetType.selected",this.selectedDatasetTypes)},a.jsonp(g).then(function(a){var b=a.data.facet_counts.facet_fields.dataset_type.filter(function(a){return"string"==typeof a?!0:!1});h.datasetTypes=b,h.selectedDatasetTypes=f()||e(b),h.changed()})}]),d.directive("datasetTypes",function(){return{restrict:"E",templateUrl:"templates/dataset-types.html",controller:"DatasetTypesController",controllerAs:"dataTypeCtrl"}})}(window,angular,wb),function(a,b,c){"use strict";var d=b.module("display-fields",["fields"]);d.controller("DisplayFieldsController",["$rootScope","$scope",function(a,b){function d(){var b,d=c.pageUrlParts.params.fl;return d?(b=[].concat(e.mandatoryFields),decodeURI(d).split(",").forEach(function(a){-1===b.indexOf(a)&&b.push(a)}),a.$on("datasetType.selected",function(b){setTimeout(function(){var b=$("#displayfield").scope().fieldsCtrl.fields;e.fields=e.fields.filter(function(a){return-1===b.indexOf(a)?!1:!0}),a.$apply()},500)}),b):null}var e=this;this.field="",this.mandatoryFields=["name"],this.fields=d()||["name","extras_content_type_codes","extras_subject_codes","extras_title_en_txts","extras_admin_notes"],this.getVisible=function(){return 0!==this.fields.length},this.getMandatory=function(a){return-1!==this.mandatoryFields.indexOf(a)},this.addField=function(){this.field&&-1===this.fields.indexOf(this.field)&&(this.fields.push(this.field),this.field="")},this.removeField=function(a){this.fields.splice(this.fields.indexOf(a),1)}}]),d.directive("displayFields",function(){return{restrict:"E",templateUrl:"templates/display-fields.html",controller:"DisplayFieldsController",controllerAs:"dspFieldCtrl"}})}(window,angular,wb),function(a,b){"use strict";var c=b.module("fields",["services.config"]);c.controller("FieldsController",["$http","$q","$rootScope","configuration",function(a,b,c,d){var e=this;this.datasetTypesFields={},this.fields=[],c.$on("datasetType.selected",function(c,f){var g,h,i,j=d.solrCore+"/select?q=*&rows=1&fl=extras_*,name&wt=json&json.wrf=JSON_CALLBACK&fq=dataset_type:",k=function(a){var b=a.responseHeader.params.fq,c=b.substr(b.indexOf(":")+1);e.datasetTypesFields[c]=Object.keys(a.response.docs[0]),m=m.concat(e.datasetTypesFields[c])},l=[],m=[];for(g=0;g<f.length;g+=1)h=f[g],e.datasetTypesFields[h]?m=m.concat(e.datasetTypesFields[h]):(i=a.jsonp(j+h,{cache:!0}),i.success(k),l.push(i));b.all(l).then(function(){e.fields=[],m.forEach(function(a,b,c){-1===e.fields.indexOf(a)&&e.fields.push(a)}),e.fields.sort()})})}])}(window,angular);
//# sourceMappingURL=app.min.js.map